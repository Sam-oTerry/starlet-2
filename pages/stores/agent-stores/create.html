<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Agent Store - Starlet Properties</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .create-store-container {
      max-width: 1300px;
      margin: 3rem auto;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      padding: 2.5rem 2.5rem;
    }
    .form-label { font-weight: 500; }
    .form-control, .form-select { border-radius: 8px; }
    .form-section-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: #0d6efd;
    }
    .btn-primary { width: 100%; }
    .logo-preview {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 10px;
      margin-bottom: 1rem;
      display: none;
    }
    .tier-card {
      border-radius: 1.2rem;
      transition: box-shadow 0.2s, border 0.2s, background 0.2s, transform 0.2s;
      background: #fff;
      cursor: pointer;
      border: 2.5px solid transparent;
      position: relative;
      width: max-content;
      min-width: 320px;
      max-width: 100%;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 8px 32px 0 rgba(13,110,253,0.13), 0 2px 16px rgba(0,0,0,0.10);
      margin-bottom: 1.2rem;
      padding: 2rem 1.5rem 1.5rem 1.5rem;
    }
    .tier-card:hover {
      box-shadow: 0 8px 32px 0 rgba(0,212,255,0.13);
      border-color: #0dcaf0;
      background: #f8fcff;
      transform: translateY(-4px) scale(1.03);
    }
    .tier-card.selected {
      border-color: #0d6efd;
      background: #eaf6ff;
      box-shadow: 0 8px 32px 0 rgba(13,110,253,0.13);
      transform: scale(1.05);
      z-index: 2;
    }
    .tier-card.selected::after {
      content: '\2713';
      position: absolute;
      top: 16px;
      right: 16px;
      background: #0d6efd;
      color: #fff;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      box-shadow: 0 2px 8px rgba(13,110,253,0.15);
      z-index: 2;
    }
    .tier-header.silver { color: #6c757d; font-weight: 700; font-size: 1.2rem; }
    .tier-header.gold { color: #ffd700; font-weight: 700; font-size: 1.2rem; }
    .tier-header.diamond { color: #0dcaf0; font-weight: 700; font-size: 1.2rem; }
    .tier-header .popular {
      background: #ffd700;
      color: #222;
      font-size: 0.9rem;
      font-weight: 700;
      border-radius: 1rem;
      padding: 0.25em 1em;
      margin-left: 0.5em;
      position: absolute;
      top: -18px;
      right: 0;
      box-shadow: 0 2px 8px rgba(255,215,0,0.13);
      z-index: 3;
    }
    .tier-header { display: flex; flex-direction: column; align-items: center; gap: 0.2em; position: relative; margin-bottom: 1.1rem; }
    .tier-header h3 { margin: 0; font-size: 1.2rem; font-weight: 700; }
    .tier-header .fa-medal { color: #adb5bd; }
    .tier-header .fa-crown { color: #ffd700; }
    .tier-header .fa-gem { color: #0dcaf0; }
    .tier-content ul { list-style: none; padding: 0; margin: 0; }
    .tier-content li {
      padding: 0.6em 0;
      font-size: 1.08rem;
      display: flex;
      align-items: center;
      gap: 0.7em;
      white-space: normal;
      word-break: break-word;
      margin-left: 0.2em;
      margin-right: 0.2em;
    }
    .tier-content li::before {
      content: '\2714';
      color: #20c997;
      font-weight: bold;
      margin-right: 0.5em;
      font-size: 1.1em;
    }
    .tier-content li:last-child { margin-bottom: 0; }
    .tier-content { padding: 0.5rem 0.5rem 0.5rem 0.5rem; margin-bottom: 0.5rem; }
    #tierCards { background: linear-gradient(135deg, #f8fafd 60%, #eaf6ff 100%); border-radius: 1.2rem; padding: 1.2rem 0.5rem; }
    #tierCards .row.g-3 {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: stretch;
      gap: 0;
      transition: gap 0.3s;
      position: relative;
      margin-left: 0;
      margin-right: 0;
    }
    #tierCards .col-md-4 {
      display: flex;
      justify-content: center;
      align-items: stretch;
      transition: z-index 0.4s, transform 0.4s, margin 0.4s;
      margin-left: -35px;
      margin-right: -35px;
      z-index: 1;
      position: relative;
    }
    #tierCards .col-md-4:first-child { margin-left: 0; }
    #tierCards .col-md-4:last-child { margin-right: 0; }
    #tierCards .col-md-4.poker-infront {
      z-index: 10;
      transform: scale(1.13) translateY(-18px);
      box-shadow: 0 12px 40px 0 rgba(13,110,253,0.18);
    }
    #tierCards .col-md-4:not(.poker-infront) {
      filter: blur(0.5px) grayscale(0.08);
      opacity: 0.92;
    }
    @media (max-width: 991px) {
      .create-store-container { max-width: 98vw; } .tier-card { width: 100%; min-width: 0; }
      #tierCards .row.g-3 { flex-direction: column; gap: 1rem; }
      #tierCards .col-md-4, #tierCards .col-md-4.poker-infront {
        margin: 0 !important;
        z-index: 1 !important;
        transform: none !important;
        filter: none !important;
        opacity: 1 !important;
      }
    }
    @media (max-width: 767px) {
      .create-store-container { padding: 1.2rem 0.5rem; }
      .tier-header h3 { font-size: 1rem; }
      #tierCards .col-md-4 { flex: 0 0 100%; max-width: 100%; margin-bottom: 1rem; }
      #tierCards .row.g-3 { flex-direction: column; }
      #tierCards { padding: 0.5rem 0.2rem; }
    }
    @media (max-width: 600px) { .tier-card { width: 100%; min-width: 0; } .tier-content li { white-space: normal; } }
    .icon-circle {
      background: #fff;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex !important;
      align-items: center;
      justify-content: center;
      font-size: 1.35rem;
      color: #ffd700;
      box-shadow: 0 1px 4px rgba(0,0,0,0.07);
      margin: 0 2px;
      transition: background 0.2s, color 0.2s;
      position: relative;
    }
    .icon-circle:hover, .icon-circle:focus {
      background: #e3f0ff;
      color: #ffd700;
      text-decoration: none;
    }
    .navbar-custom .brand-star {
      color: #ffd700;
    }
    .navbar-custom .brand-let {
      color: #00e6ff;
    }
    .navbar-custom .btn-warning {
      background: #ffd700 !important;
      border: none;
      color: #fff !important;
      font-weight: 700;
      font-size: 1.1rem;
      box-shadow: 0 1px 4px rgba(0,0,0,0.07);
    }
    .navbar-custom .btn-warning:hover {
      background: #ffd700cc !important;
      color: #03254c !important;
    }
  </style>
</head>
<body>
  <!-- Navbar (from index.html) -->
  <nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container">
      <a class="navbar-brand" href="/index.html">
        <span class="brand-star">Star</span> <span class="brand-let">Let</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0 d-flex align-items-center" style="gap: 0.7rem;">
          <li class="nav-item">
            <a class="nav-link icon-circle" href="../../user/saved.html" title="Saved">
              <i class="bi bi-bookmark"></i>
            </a>
          </li>
          <li class="nav-item position-relative">
            <a class="nav-link icon-circle position-relative" href="../../user/messaging.html" title="Messages" id="messagesNavLink">
              <i class="bi bi-chat-dots"></i>
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none" id="unreadMessagesBadge">0</span>
            </a>
          </li>
          <li class="nav-item position-relative" id="nav-notification-bell">
            <a class="nav-link icon-circle position-relative" href="../../user/notifications.html" title="Notifications">
              <i class="bi bi-bell"></i>
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none" id="notification-badge">0</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link icon-circle" id="myListingsLink" href="#" title="My Listings">
              <i class="bi bi-card-list"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link icon-circle" id="profileLink" href="#" title="Profile">
              <i class="bi bi-person"></i>
            </a>
          </li>
          <li class="nav-item ms-2">
            <a class="btn btn-warning fw-bold px-4" href="../../dashboard/listings/add.html" style="color: #fff; border-radius: 8px;">SELL</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container">
    <div class="create-store-container" style="max-width: 1100px;">
      <div class="form-section-title">Create Your Agent Store</div>
      <form id="createStoreForm" class="mb-4">
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label for="storeName" class="form-label">Store Name</label>
              <input type="text" class="form-control" id="storeName" name="storeName" required>
            </div>
            <div class="mb-3">
              <label for="storeDescription" class="form-label">Description</label>
              <textarea class="form-control" id="storeDescription" name="storeDescription" rows="3" required></textarea>
            </div>
            <div class="mb-3">
              <label for="storeLogo" class="form-label">Store Logo</label>
              <input class="form-control" type="file" id="storeLogo" name="storeLogo" accept="image/*">
              <img id="logoPreview" class="logo-preview" alt="Logo Preview">
            </div>
            <div class="mb-3">
              <label for="storeContact" class="form-label">Contact Number</label>
              <input type="tel" class="form-control" id="storeContact" name="storeContact" required>
            </div>
            <div class="mb-3">
              <label for="storeEmail" class="form-label">Contact Email</label>
              <input type="email" class="form-control" id="storeEmail" name="storeEmail" required readonly>
            </div>
            <div class="mb-3">
              <label for="storeLocation" class="form-label">Location</label>
              <input type="text" class="form-control" id="storeLocation" name="storeLocation" required>
            </div>
            <div class="mb-3">
              <label for="agentTier" class="form-label">Agent Tier</label>
              <select class="form-select" id="agentTier" name="agentTier" required>
                <option value="">Select Tier</option>
                <option value="silver">Silver (Free)</option>
                <option value="gold">Gold</option>
                <option value="diamond">Diamond</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary">Create Store</button>
          </div>
          <div class="col-md-6">
            <h4 class="mb-3 text-center" style="font-weight:700;letter-spacing:0.01em;">Select Agent Tier</h4>
            <p class="mb-4 text-center text-secondary" style="max-width: 500px; margin: 0 auto; font-size: 1.08rem;">
              Choose the plan that best fits your business goals. Each tier unlocks new features and greater visibility. Select a tier to see your store grow and reach more clients!
            </p>
            <div class="row g-3" id="tierCards">
              <div class="col-12 col-lg-12">
                <div class="row g-3">
                  <div class="col-md-4">
                    <div class="tier-card h-100 border-0 shadow-sm">
                      <div class="tier-header silver text-center">
                        <i class="fas fa-medal fa-2x"></i>
                        <h3>Silver</h3>
                        <div class="tier-fee"><span id="silverFee">...</span></div>
                      </div>
                      <div class="tier-content">
                        <ul>
                          <li>Essential listing tools</li>
                          <li>Standard marketplace exposure</li>
                          <li>Email support</li>
                          <li>Affordable monthly plan</li>
                          <li>Great for new agents</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="tier-card featured h-100 border-0 shadow-sm">
                      <div class="tier-header gold text-center">
                        <i class="fas fa-crown fa-2x"></i>
                        <h3>Gold</h3>
                        <span class="popular">Popular</span>
                        <div class="tier-fee"><span id="goldFee">...</span></div>
                      </div>
                      <div class="tier-content">
                        <ul>
                          <li>All Silver features</li>
                          <li>Priority listing placement</li>
                          <li>Featured property highlights</li>
                          <li>Advanced analytics dashboard</li>
                          <li>Priority customer support</li>
                          <li>Ideal for growing agents</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="tier-card h-100 border-0 shadow-sm">
                      <div class="tier-header diamond text-center">
                        <i class="fas fa-gem fa-2x"></i>
                        <h3>Diamond</h3>
                        <div class="tier-fee"><span id="diamondFee">...</span></div>
                      </div>
                      <div class="tier-content">
                        <ul>
                          <li>All Gold features</li>
                          <li>Unlimited premium listings</li>
                          <li>Maximum marketplace visibility</li>
                          <li>24/7 VIP support</li>
                          <li>Custom store branding & URL</li>
                          <li>Advanced reporting & insights</li>
                          <li>Best for top-performing agents</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="/assets/js/firebase-config.js"></script>
  <script src="../../../js/main.js"></script>
  <script>
  // Enforce authentication on this page
  enforceAuth('../../../auth/login.html');
  // Setup My Listings link logic
  document.addEventListener('DOMContentLoaded', function() {
      setupMyListingsLink('#myListingsLink', '../../../auth/login.html', '../../../stores/agent-stores/dashboard.html', '../../../stores/agent-stores/create.html');
  });
    // Show logo preview
    document.getElementById('storeLogo').addEventListener('change', function(e) {
      const file = e.target.files[0];
      const preview = document.getElementById('logoPreview');
      if (file) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          preview.src = evt.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        preview.src = '';
        preview.style.display = 'none';
      }
    });
    // Autofill email if logged in
    firebase.auth().onAuthStateChanged(function(user) {
      if (user && user.email) {
        document.getElementById('storeEmail').value = user.email;
      }
    });
    // Handle form submit
    document.getElementById('createStoreForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const user = firebase.auth().currentUser;
      if (!user) {
        alert('You must be logged in to create a store.');
        return;
      }
      const db = firebase.firestore();
      const name = document.getElementById('storeName').value.trim();
      const description = document.getElementById('storeDescription').value.trim();
      const contact = document.getElementById('storeContact').value.trim();
      const email = document.getElementById('storeEmail').value.trim();
      const location = document.getElementById('storeLocation').value.trim();
      const agentTier = document.getElementById('agentTier').value;
      let logoUrl = '';
      // Optionally handle logo upload here (to Firebase Storage)
      // For now, just use preview as base64 (not recommended for production)
      const logoInput = document.getElementById('storeLogo');
      if (logoInput.files[0]) {
        const reader = new FileReader();
        logoUrl = await new Promise(resolve => {
          reader.onload = e => resolve(e.target.result);
          reader.readAsDataURL(logoInput.files[0]);
        });
      }
      try {
        // 1. Create the store
        const storeRef = await db.collection('stores').add({
          name,
          description,
          contact,
          email,
          location,
          agentTier,
          logo: logoUrl,
          ownerId: user.uid,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        });
        // 2. Update user role to 'agent'
        await db.collection('users').doc(user.uid).set({ role: 'agent' }, { merge: true });
        alert('Store created successfully!');
        window.location.href = 'dashboard.html';
      } catch (err) {
        alert('Error creating store: ' + err.message);
      }
    });
    // Tier card selection logic
    const tierCards = document.querySelectorAll('.tier-card');
    const tierSelect = document.getElementById('agentTier');
    function selectTier(tier) {
      tierCards.forEach(card => {
        if (card.classList.contains(tier)) {
          card.classList.add('selected');
        } else {
          card.classList.remove('selected');
        }
      });
      tierSelect.value = tier;
    }
    tierCards.forEach(card => {
      card.addEventListener('click', function() {
        const tier = this.querySelector('.tier-header').classList.contains('silver') ? 'silver'
          : this.querySelector('.tier-header').classList.contains('gold') ? 'gold'
          : 'diamond';
        selectTier(tier);
      });
    });
    tierSelect.addEventListener('change', function() {
      selectTier(this.value);
    });
    // Set initial selection if any
    if (tierSelect.value) selectTier(tierSelect.value);

    // Poker card effect for tier cards
    (function() {
      const cardCols = Array.from(document.querySelectorAll('#tierCards .col-md-4'));
      if (cardCols.length !== 3) return;
      function isDesktop() { return window.innerWidth > 991; }
      cardCols.forEach((col) => {
        col.addEventListener('mouseenter', function() {
          if (!isDesktop()) return;
          cardCols.forEach(c => c.classList.remove('poker-infront'));
          this.classList.add('poker-infront');
        });
        col.addEventListener('mouseleave', function() {
          if (!isDesktop()) return;
          this.classList.remove('poker-infront');
        });
      });
      window.addEventListener('resize', () => {
        if (!isDesktop()) cardCols.forEach(c => c.classList.remove('poker-infront'));
      });
    })();

    // --- Tier Fee Fetching Logic ---
    const tierFees = {
      silver: { fee: null, currency: 'UGX', default: 0 },
      gold: { fee: null, currency: 'UGX', default: 0 },
      diamond: { fee: null, currency: 'UGX', default: 0 }
    };

    function formatFee(fee, currency) {
      if (fee === null || fee === undefined) return '...';
      return fee.toLocaleString() + ' ' + currency;
    }

    function updateTierFeesUI() {
      // Silver
      const silverFeeEl = document.getElementById('silverFee');
      if (silverFeeEl) silverFeeEl.textContent = formatFee(tierFees.silver.fee ?? tierFees.silver.default, tierFees.silver.currency);
      // Gold
      const goldFeeEl = document.getElementById('goldFee');
      if (goldFeeEl) goldFeeEl.textContent = formatFee(tierFees.gold.fee ?? tierFees.gold.default, tierFees.gold.currency);
      // Diamond
      const diamondFeeEl = document.getElementById('diamondFee');
      if (diamondFeeEl) diamondFeeEl.textContent = formatFee(tierFees.diamond.fee ?? tierFees.diamond.default, tierFees.diamond.currency);
    }

    async function fetchTierFees() {
      try {
        const db = window.firebaseDB || firebase.firestore();
        const doc = await db.collection('settings').doc('tiers').get();
        if (doc.exists) {
          const data = doc.data();
          if (data.silver) tierFees.silver.fee = data.silver.fee, tierFees.silver.currency = data.silver.currency || 'UGX';
          if (data.gold) tierFees.gold.fee = data.gold.fee, tierFees.gold.currency = data.gold.currency || 'UGX';
          if (data.diamond) tierFees.diamond.fee = data.diamond.fee, tierFees.diamond.currency = data.diamond.currency || 'UGX';
        }
      } catch (e) {
        console.warn('Could not fetch tier fees:', e);
      } finally {
        updateTierFeesUI();
      }
    }

    document.addEventListener('DOMContentLoaded', fetchTierFees);
  </script>
  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 mb-4">
          <h4>About Starlet Properties</h4>
          <p>Uganda's premier real estate and vehicle marketplace, connecting buyers and sellers across the country.</p>
          <div class="social-links">
            <a href="#"><i class="fab fa-facebook"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-linkedin"></i></a>
          </div>
        </div>
        <div class="col-lg-2 col-md-6 mb-4">
          <h4>Properties</h4>
          <ul>
            <li><a href="../../properties/index.html?type=house_sale">Houses for Sale</a></li>
            <li><a href="../../properties/index.html?type=house_rent">Houses for Rent</a></li>
            <li><a href="../../properties/index.html?type=land_sale">Land for Sale</a></li>
            <li><a href="../../properties/index.html?type=land_rent">Land for Rent</a></li>
            <li><a href="../../properties/index.html?type=commercial">Commercial Property</a></li>
            <li><a href="../../properties/index.html?type=vacation_short_stay">Vacation & Short Stay</a></li>
          </ul>
        </div>
        <div class="col-lg-2 col-md-6 mb-4">
          <h4>Vehicles</h4>
          <ul>
            <li><a href="../../vehicles/index.html?type=cars">Cars</a></li>
            <li><a href="../../vehicles/index.html?type=motorcycles">Motorcycles</a></li>
            <li><a href="../../vehicles/index.html?type=trucks">Trucks</a></li>
            <li><a href="../../vehicles/index.html?type=buses">Buses</a></li>
            <li><a href="../../vehicles/index.html?type=heavy_machinery">Heavy Machinery</a></li>
            <li><a href="../../vehicles/index.html?type=bicycles_ebikes">Bicycles & E-bikes</a></li>
            <li><a href="../../vehicles/index.html?type=boats_watercraft">Boats & Watercraft</a></li>
          </ul>
        </div>
        <div class="col-lg-2 col-md-6 mb-4">
          <h4>Company</h4>
          <ul>
            <li><a href="../../about/index.html">About Us</a></li>
            <li><a href="../../about/contact.html">Contact</a></li>
            <li><a href="../../about/resources.html">Resources</a></li>
            <li><a href="../index.html">Our Stores</a></li>
            <li><a href="../../legal/privacy.html">Privacy Policy</a></li>
          </ul>
        </div>
        <div class="col-lg-2 col-md-6 mb-4">
          <h4>Contact</h4>
          <ul>
            <li><a href="tel:+256123456789"><i class="bi bi-telephone"></i> +256 123 456 789</a></li>
            <li><a href="mailto:info@starlet.co.ug"><i class="bi bi-envelope"></i> info@starlet.co.ug</a></li>
            <li><a href="#"><i class="bi bi-geo-alt"></i> Kampala, Uganda</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <div class="row">
          <div class="col-md-6">
            <p class="mb-0">&copy; 2024 Starlet Properties. All rights reserved.</p>
          </div>
          <div class="col-md-6 text-md-end">
            <a href="../../legal/terms.html" class="me-3">Terms of Service</a>
            <a href="../../legal/privacy.html">Privacy Policy</a>
          </div>
        </div>
      </div>
    </div>
  </footer>
</body>
</html> 